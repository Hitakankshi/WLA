<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review Package - A Divine Trip to Puri</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <!-- Load Lucide Icons for small icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            padding-bottom: 3rem;
        }
        .header-step {
            display: flex;
            align-items: center;
            padding: 0.75rem 0.5rem;
            color: #1a1a1a;
            position: relative;
            font-size: 0.875rem; /* sm */
            cursor: pointer; /* Indicate clickable steps */
        }
        .header-step:not(.active):hover {
            color: #004d99;
        }
        .header-step.active .step-number {
            background-color: #004d99; /* Dark Blue from Image */
            color: white;
        }
        .header-step.active {
            font-weight: 600;
        }
        .step-number {
            width: 1.5rem;
            height: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: #e0e0e0;
            margin-right: 0.5rem;
            font-size: 0.75rem; /* xs */
        }
        .separator {
            content: '';
            width: 1.5rem;
            height: 1px;
            background-color: #cccccc;
            margin: 0 0.5rem;
            /* Hide on very small screens for better wrapping */
            display: none;
        }
        @media (min-width: 640px) { /* sm breakpoint */
             .separator {
                display: block;
            }
             .header-step {
                font-size: 0.9375rem; /* Slightly larger on desktop */
            }
        }
        /* Custom border/shadow for cards */
        .card {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
        .sidebar-card {
            background-color: white;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            margin-bottom: 1rem;
        }
        .form-input-group {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        .form-label {
            font-size: 0.875rem;
            color: #333;
            font-weight: 500;
        }
        .form-input, .form-select {
            border: 1px solid #ccc;
            border-radius: 0.375rem;
            padding: 0.5rem 0.75rem;
            font-size: 1rem;
            width: 100%;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }
        .form-input:focus, .form-select:focus {
            border-color: #3b82f6; /* Blue 500 */
            outline: 0;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }
        .traveler-card {
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .radio-group input[type="radio"] {
            display: none;
        }
        .radio-group label {
            padding: 0.5rem 1rem;
            border: 1px solid #ccc;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .radio-group input[type="radio"]:checked + label {
            border-color: #004d99;
            color: #004d99;
            background-color: #e6f0fa;
            font-weight: 600;
        }

        /* Styling for the Traveler Pills in the Modal */
        .traveler-pill {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 0.25rem;
            width: 6rem; /* fixed width for pills */
            border: 1px solid #ccc;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
            text-align: center;
        }
        .traveler-pill .pill-icon {
            width: 1.25rem;
            height: 1.25rem;
            margin-bottom: 0.25rem;
        }
        .traveler-pill.active-pill {
            border-color: #004d99;
            color: #004d99;
            background-color: #e6f0fa;
            font-weight: 600;
        }

        /* Fixed sidebar on desktop */
        @media (min-width: 1024px) { /* lg breakpoint */
            .sidebar-sticky {
                position: sticky;
                top: 1rem;
                max-height: calc(100vh - 2rem);
                overflow-y: auto;
            }
        }
        /* Timer styling */
        .timer-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            background-color: #ff3b30; /* Red */
            color: white;
            font-weight: 700;
            box-shadow: 0 0 0 5px rgba(255, 59, 48, 0.2);
            font-size: 1rem;
        }
        /* Custom styling for the link behavior */
        .payment-link {
            display: block;
            width: 100%;
        }
        .payment-link.disabled {
            pointer-events: none; /* Prevents clicks when disabled */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <!-- NEW: Top Branding Header -->
    <div class="w-full bg-white shadow-md mb-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center">
            <!-- MODIFIED: Wrapped h1 in an <a> tag -->
            <a href="#" aria-label="Wonderlight Adventure Home" class="flex items-baseline">
                <h1 class="text-3xl font-extrabold text-blue-600 mr-2">Wonderlight Adventure</h1>
            </a>
            <span class="text-lg text-orange-500 font-semibold mt-1">Our Package</span>
        </div>
    </div>
    <!-- END: Top Branding Header -->

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Top Review Header -->
        <div class="bg-white p-4 rounded-b-lg shadow-md mb-6 sticky top-0 z-10">
            <h1 class="text-xl font-bold text-gray-800 mb-4">Review Package</h1>
            <div class="flex flex-wrap sm:flex-nowrap justify-between items-center text-center" id="booking-steps">
                <!-- Added onclick handlers to switch sections -->
                <div class="header-step active" data-step="1" onclick="showSection(1)">
                    <span class="step-number">1</span> Traveller Details
                </div>
                <div class="separator"></div>
                <div class="header-step" data-step="2" onclick="showSection(2)">
                    <span class="step-number">2</span> Package Add-ons
                </div>
                <div class="separator"></div>
                <div class="header-step" data-step="3" onclick="showSection(3)">
                    <span class="step-number">3</span> Package Itinerary & Inclusions
                </div>
                <div class="separator"></div>
                <div class="header-step" data-step="4" onclick="showSection(4)">
                    <span class="step-number">4</span> Cancellation & Date Change
                </div>
            </div>
        </div>

        <!-- Main Content Section Container -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- Left Column: Details and Forms -->
            <div class="lg:col-span-2 space-y-6">

                <!-- Package Header Card (Always Visible) -->
                <div class="card p-6">
                    <div class="flex justify-between items-start">
                        <h2 class="text-2xl font-bold text-gray-900">A Divine Trip to Puri</h2>
                        <!-- ADDED: onclick handler to open the modal -->
                        <button id="customize-btn" class="text-blue-600 border border-blue-600 text-sm py-1 px-3 rounded-full hover:bg-blue-50 transition duration-150" onclick="openCustomizationModal()">Customizable</button>
                    </div>
                    <p class="text-sm text-gray-500 mt-1">3N Puri</p>
                    <div class="flex flex-wrap items-center mt-4 text-sm font-medium text-gray-700">
                        <span class="flex items-center" id="package-dates-wrapper">
                            <i data-lucide="calendar" class="w-4 h-4 mr-1 text-gray-500"></i>
                            <!-- ADDED ID for date update -->
                            <span id="package-dates">Mon, Oct 13, 2025 - Thu, Oct 16, 2025</span>
                        </span>
                        <span class="text-blue-600 font-bold mx-2">(4D/3N)</span>
                        <!-- ADDED ID for location update -->
                        <span id="package-location" class="text-gray-500">/ From Bhubaneswar</span>
                        <span class="mx-4 text-gray-300 hidden sm:block">|</span>
                        <span class="flex items-center mt-2 sm:mt-0">
                            <i data-lucide="bed" class="w-4 h-4 mr-1 text-gray-500"></i>
                            <!-- UPDATED ID for dynamic count update -->
                            <span id="room-details">1 Room - 4 Adults</span> 
                        </span>
                    </div>
                </div>


                <!-- STEP 1: Traveler Details Section (Default Visible) -->
                <div id="section-1" class="booking-section">
                    <div class="card p-6">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                            <span class="step-number active mr-2">1</span> Traveler Details
                        </h3>

                        <!-- Traveler Type Radio -->
                        <div class="flex space-x-4 mb-6 radio-group" id="traveler-radio-group">
                            <input type="radio" id="book-myself" name="booking-type" value="myself" checked>
                            <label for="book-myself" class="flex items-center"><i data-lucide="user" class="w-4 h-4 mr-2"></i> I'm Booking For Myself</label>

                            <input type="radio" id="book-someone" name="booking-type" value="someone">
                            <label for="book-someone" class="flex items-center"><i data-lucide="users" class="w-4 h-4 mr-2"></i> I'm Booking for someone else</label>
                        </div>

                        <!-- Traveler Inputs Container (Fixed Travelers 1-4) -->
                        <div id="travelers-container" class="space-y-4">
                            
                            <!-- Traveler 1 (Primary) -->
                            <div class="traveler-card" id="traveler-1">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="flex items-center">
                                        <i data-lucide="user-circle" class="w-6 h-6 mr-3 text-blue-600"></i>
                                        <span class="font-medium text-lg" id="t1-name-title">Traveler 1</span>
                                        <!-- NEW: Profile Status Badge -->
                                        <span id="t1-profile-status" class="flex items-center text-sm text-green-600 ml-3 hidden">
                                            <i data-lucide="check-circle" class="w-4 h-4 mr-1"></i> Profile Updated
                                        </span>
                                    </span>
                                    <div class="flex space-x-3 items-center">
                                        <button id="t1-btn" class="text-blue-600 font-medium text-sm hover:underline" onclick="openAddTravelerModal('traveler-1')">Add Traveler</button>
                                        <!-- Remove Button -->
                                        <button id="t1-remove-btn" class="text-red-500 font-medium text-sm hover:underline" onclick="removeTraveler('traveler-1')">Remove</button>
                                    </div>
                                </div>
                                <!-- Updated: Name now displayed here, using 't1-name-detail' -->
                                <div id="t1-name-detail" class="text-base font-bold text-blue-900 ml-9 hidden"></div> 
                                <p class="text-xs text-gray-500 mt-2">ADULT - SHOULD BE ABOVE 18 YEARS</p>
                            </div>

                            <!-- Traveler 2 (Adult) -->
                            <div class="traveler-card" id="traveler-2">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="flex items-center">
                                        <i data-lucide="user-circle" class="w-6 h-6 mr-3 text-blue-600"></i>
                                        <span class="font-medium text-lg" id="t2-name-title">Traveler 2</span>
                                        <span id="t2-profile-status" class="flex items-center text-sm text-green-600 ml-3 hidden">
                                            <i data-lucide="check-circle" class="w-4 h-4 mr-1"></i> Profile Updated
                                        </span>
                                    </span>
                                    <div class="flex space-x-3 items-center">
                                        <button id="t2-btn" class="text-blue-600 font-medium text-sm hover:underline" onclick="openAddTravelerModal('traveler-2')">Add Traveler</button>
                                        <!-- Remove Button -->
                                        <button id="t2-remove-btn" class="text-red-500 font-medium text-sm hover:underline" onclick="removeTraveler('traveler-2')">Remove</button>
                                    </div>
                                </div>
                                <!-- Updated: Name now displayed here, using 't2-name-detail' -->
                                <div id="t2-name-detail" class="text-base font-bold text-blue-900 ml-9 hidden"></div>
                                <p class="text-xs text-gray-500 mt-2">ADULT - SHOULD BE ABOVE 18 YEARS</p>
                            </div>

                            <!-- Traveler 3 (Child) -->
                            <div class="traveler-card" id="traveler-3">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="flex items-center">
                                        <i data-lucide="user-circle" class="w-6 h-6 mr-3 text-blue-600"></i>
                                        <span class="font-medium text-lg" id="t3-name-title">Traveler 3</span>
                                        <span id="t3-profile-status" class="flex items-center text-sm text-green-600 ml-3 hidden">
                                            <i data-lucide="check-circle" class="w-4 h-4 mr-1"></i> Profile Updated
                                        </span>
                                    </span>
                                    <div class="flex space-x-3 items-center">
                                        <button id="t3-btn" class="text-blue-600 font-medium text-sm hover:underline" onclick="openAddTravelerModal('traveler-3')">Add Traveler</button>
                                        <!-- Remove Button -->
                                        <button id="t3-remove-btn" class="text-red-500 font-medium text-sm hover:underline" onclick="removeTraveler('traveler-3')">Remove</button>
                                    </div>
                                </div>
                                <!-- Updated: Name now displayed here, using 't3-name-detail' -->
                                <div id="t3-name-detail" class="text-base font-bold text-blue-900 ml-9 hidden"></div>
                                <p class="text-xs text-gray-500 mt-2">ADULT - SHOULD BE ABOVE 12 YEARS</p>
                            </div>
                            
                            <!-- Traveler 4 (Adult Traveler) -->
                            <div class="traveler-card" id="traveler-4">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="flex items-center">
                                        <i data-lucide="user-circle" class="w-6 h-6 mr-3 text-blue-600"></i>
                                        <span class="font-medium text-lg" id="t4-name-title">Traveler 4</span>
                                        <span id="t4-profile-status" class="flex items-center text-sm text-green-600 ml-3 hidden">
                                            <i data-lucide="check-circle" class="w-4 h-4 mr-1"></i> Profile Updated
                                        </span>
                                    </span>
                                    <div class="flex space-x-3 items-center">
                                        <button id="t4-btn" class="text-blue-600 font-medium text-sm hover:underline" onclick="openAddTravelerModal('traveler-4')">Add Traveler</button>
                                        <!-- Remove Button -->
                                        <button id="t4-remove-btn" class="text-red-500 font-medium text-sm hover:underline" onclick="removeTraveler('traveler-4')">Remove</button>
                                    </div>
                                </div>
                                <!-- Updated: Name now displayed here, using 't4-name-detail' -->
                                <div id="t4-name-detail" class="text-base font-bold text-blue-900 ml-9 hidden"></div>
                                <p class="text-xs text-gray-500 mt-2">ADULT - SHOULD BE ABOVE 18 YEARS</p>
                            </div>
                        </div>

                        <!-- NEW: Dynamic Add Traveler Button -->
                        <div class="mt-4 pt-4 border-t border-gray-200">
                            <button class="flex items-center text-blue-600 font-semibold hover:text-blue-700 transition" onclick="addDynamicTraveler()">
                                <i data-lucide="plus-circle" class="w-5 h-5 mr-2"></i>
                                + Add Another Traveller
                            </button>
                        </div>

                        <h4 class="text-lg font-semibold mt-8 mb-4">Please enter contact details</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="form-input-group">
                                <label for="email" class="form-label">Email*</label>
                                <input type="email" id="email" class="form-input" placeholder="e.g. john.doe@email.com" value="john.doe@email.com" >
                                <p class="text-xs text-red-500 mt-1">Enter a Valid Email</p>
                            </div>
                            
                            <!-- Mobile Code is now a Select dropdown -->
                            <div class="form-input-group">
                                <label for="country-code" class="form-label">Mobile Code*</label>
                                <select id="country-code" class="form-select text-gray-800">
                                    <!-- Options populated by JavaScript -->
                                </select>
                            </div>

                            <div class="form-input-group">
                                <label for="mobile" class="form-label">Mobile*</label>
                                <input type="tel" id="mobile" class="form-input" value="7719099164" >
                            </div>
                        </div>

                        <h4 class="text-lg font-semibold mt-8 mb-4">Please enter GST details</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="form-input-group md:col-span-1">
                                <label for="gst-state" class="form-label">GST State</label>
                                <select id="gst-state" class="form-select text-gray-800">
                                    <!-- Options populated by JavaScript -->
                                </select>
                            </div>
                        </div>

                        <h4 class="text-lg font-semibold mt-8 mb-4">Special Requests</h4>
                        <div class="form-input-group">
                            <!-- Removed ID for LLM input -->
                            <textarea rows="3" id="special-requests-textarea" class="form-input" placeholder="Enter Special Requests"></textarea>
                        </div>
                        
                        <!-- REMOVED: GEMINI LLM Button -->
                        <!-- REMOVED: Loading Status -->
                    </div>
                </div>

                <!-- STEP 2: Package Add-ons Section (New Content) -->
                <div id="section-2" class="booking-section hidden">
                    <div class="card p-6">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                            <span class="step-number active mr-2">2</span> Package Add-ons
                        </h3>
                        <p class="text-gray-600 mb-4">Enhance your Divine Trip to Puri with these optional add-ons.</p>
                        
                        <!-- REMOVED: Gemini Suggestions Area -->
                        
                        <h4 class="font-bold text-lg mb-3">Standard Upgrades</h4>
                        <div class="space-y-4">
                            <!-- Add-on 1: Room Upgrade -->
                            <div class="flex justify-between items-center p-4 border rounded-lg hover:shadow-md transition duration-150">
                                <div>
                                    <p class="font-semibold text-lg">Room Upgrade to Premium</p>
                                    <p class="text-sm text-gray-500">Enjoy a larger room with sea view.</p>
                                </div>
                                <button class="bg-green-500 text-white px-4 py-2 rounded-full text-sm font-medium hover:bg-green-600 transition">
                                    + Add (₹5,000)
                                </button>
                            </div>

                            <!-- Add-on 2: Dinner Buffet -->
                            <div class="flex justify-between items-center p-4 border rounded-lg hover:shadow-md transition duration-150">
                                <div>
                                    <p class="font-semibold text-lg">Daily Dinner Buffet</p>
                                    <p class="text-sm text-gray-500">Inclusive dinner buffet for 3 nights.</p>
                                </div>
                                <button class="bg-green-500 text-white px-4 py-2 rounded-full text-sm font-medium hover:bg-green-600 transition">
                                    + Add (₹1,200 / Person)
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- STEP 3: Package Itinerary & Inclusions Section (New Content) -->
                <div id="section-3" class="booking-section hidden">
                    <div class="card p-6">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                            <span class="step-number active mr-2">3</span> Package Itinerary & Inclusions
                        </h3>
                        <p class="text-gray-600 mb-4">Details about your 4-day, 3-night trip to Puri.</p>

                        <h4 class="font-bold text-lg mb-2">Inclusions:</h4>
                        <ul class="list-disc list-inside text-gray-700 ml-4 space-y-1 text-sm">
                            <li>3 Nights Accommodation in Puri</li>
                            <li>Daily Breakfast (CP Plan)</li>
                            <li>A/C Sedan for Bhubaneswar Airport Transfer</li>
                            <li>Taxes and Service Charges</li>
                        </ul>

                        <h4 class="font-bold text-lg mt-6 mb-2">Itinerary Highlights:</h4>
                        <div class="space-y-3 text-sm">
                            <p><span class="font-semibold">Day 1:</span> Arrival in Bhubaneswar & Transfer to Puri. Check-in and relax at the hotel.</p>
                            <p><span class="font-semibold">Day 2:</span> Visit Jagannath Temple, Puri Beach, and local markets.</p>
                            <p><span class="font-semibold">Day 3:</span> Excursion to Konark Sun Temple and Chilika Lake (optional boat ride).</p>
                            <p><span class="font-semibold">Day 4:</span> Check-out and transfer back to Bhubaneswar airport.</p>
                        </div>
                    </div>
                </div>

                <!-- STEP 4: Cancellation & Date Change Section (New Content) -->
                <div id="section-4" class="booking-section hidden">
                    <div class="card p-6">
                        <h3 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                            <span class="step-number active mr-2">4</span> Cancellation & Date Change
                        </h3>
                        <p class="text-gray-600 mb-4">Please review the policies carefully before proceeding to payment.</p>

                        <h4 class="font-bold text-lg mb-2 text-red-700">Cancellation Policy:</h4>
                        <ul class="list-disc list-inside text-gray-700 ml-4 space-y-2 text-sm">
                            <li>Cancellation 30 days prior to travel: 100% refund.</li>
                            <li>Cancellation 15-29 days prior: 50% refund.</li>
                            <li>Cancellation less than 15 days prior: No refund.</li>
                            <li>*Flight and specific hotel fees may be non-refundable.</li>
                        </ul>

                        <h4 class="font-bold text-lg mt-6 mb-2 text-blue-700">Date Change Policy:</h4>
                        <ul class="list-disc list-inside text-gray-700 ml-4 space-y-2 text-sm">
                            <li>Date changes are permitted free of cost up to 45 days before the original travel date.</li>
                            <li>Changes within 45 days are subject to hotel/flight availability and may incur a change fee of ₹2,500 plus any fare difference.</li>
                        </ul>
                    </div>
                </div>

            </div>

            <!-- Right Column: Summary and Payment -->
            <div class="lg:col-span-1">
                <div class="sidebar-sticky">

                    <!-- Grand Total Summary -->
                    <div class="sidebar-card p-4 bg-blue-50/70 border-l-4 border-blue-600">
                        <div class="flex justify-between items-center text-gray-800">
                            <!-- UPDATED ID for dynamic count update -->
                            <span class="text-xs font-semibold uppercase" id="grand-total-adults">Grand Total - 4 Adults</span>
                            <span class="text-xs text-green-700">Inclusive of GST</span>
                        </div>
                        <!-- ADDED ID for dynamic price update -->
                        <p class="text-3xl font-bold text-gray-900 mt-1" id="grand-total-amount">₹0</p>
                        <p class="text-sm font-semibold text-blue-600 mt-2">Pay Full Amount Now</p>
                    </div>

                    <!-- Fare Breakup -->
                    <div class="sidebar-card">
                        <h4 class="font-semibold mb-3">Fare Breakup</h4>
                        <div class="space-y-2 text-sm text-gray-700">
                            <div class="flex justify-between">
                                <!-- ADDED ID for dynamic basic cost text -->
                                <span id="fare-breakup-basic-cost">Total Basic Cost <span class="text-xs text-gray-500 block">($0 x 4 Travellers)</span></span>
                                <!-- ADDED ID for dynamic basic cost value -->
                                <span id="fare-breakup-basic-cost-value">₹43</span>
                            </div>
                            
                            <!-- Coupon Discount -->
                            <div class="flex justify-between text-green-700">
                                <span>Coupon Discount</span>
                                <!-- ADDED ID for dynamic discount value -->
                                <span id="fare-breakup-coupon-value">-₹0</span>
                            </div>

                            <div class="flex justify-between">
                                <span>Insurance</span>
                                <!-- ADDED ID for dynamic insurance value -->
                                <span id="fare-breakup-insurance-value">₹0</span>
                            </div>
                            
                            <div class="flex justify-between border-t pt-2 border-gray-200">
                                <!-- ADDED ID for tax label -->
                                <span class="font-bold" id="fare-breakup-tax-label">Item & Taxes</span>
                                <!-- ADDED ID for total tax value -->
                                <span class="font-bold" id="fare-breakup-tax-value-total">₹0</span>
                            </div>
                            
                            <!-- Detailed Tax Breakdown -->
                            <div class="flex justify-between">
                                <span class="text-xs text-gray-500">Service Tax (Estimated)</span>
                                <!-- ADDED ID for tax value -->
                                <span class="text-xs text-gray-500" id="fare-breakup-tax-value">₹0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-xs text-gray-500">GST 5.0%</span>
                                <!-- ADDED ID for GST value -->
                                <span class="text-xs text-gray-500" id="fare-breakup-gst-value">₹0</span>
                            </div>
                        </div>
                    </div>

                    <!-- EMI/Payment Block -->
                    <div class="sidebar-card p-0">
                        <div class="bg-blue-600 text-white text-center py-2 text-sm rounded-t-lg">
                            EMI Available on all payment modes
                        </div>
                        <div class="p-4">
                            <h4 class="font-semibold text-gray-800 mb-2">Important Information</h4>
                            <div class="text-xs text-gray-600 space-y-2">
                                <label class="flex items-start">
                                    <input type="checkbox" id="accept-terms" class="mt-1 mr-2 accent-blue-600">
                                    I confirm that I have read and accept Cancellation Policy, User Agreement, Terms of Service and Privacy Policy of MakeMyTrip
                                </label>
                            </div>
                            <!-- MODIFIED: Wrapped button in <a> tag and added link handling logic -->
                            <a id="proceed-link" href="#" class="payment-link disabled">
                                <button id="proceed-btn" class="w-full bg-orange-500 text-white font-bold py-3 mt-4 rounded-lg hover:bg-orange-600 transition duration-150 shadow-md disabled:opacity-50" disabled>
                                    PROCEED TO PAYMENT
                                </button>
                            </a>
                        </div>
                    </div>

                    <!-- Complete Booking Timer -->
                    <div class="sidebar-card p-4 flex justify-between items-center bg-yellow-50/50 border-t border-b border-yellow-200">
                        <span class="text-sm text-gray-700">Complete Booking in <span class="text-xs text-gray-500 block">The package price will refresh after this</span></span>
                        <div class="timer-badge" id="timer">30:00</div>
                    </div>

                    <!-- Coupons & Offers -->
                    <div class="sidebar-card">
                        <h4 class="font-semibold mb-3">Coupons & Offers</h4>
                        
                        <div class="flex justify-between items-center text-sm mb-3">
                            <span class="font-medium text-gray-800">Have a Coupon Code?</span>
                            <a href="entercode.html" class="text-blue-600 font-medium hover:underline">Enter Code</a>
                        </div>

                        <div class="space-y-3">
                            <!-- Coupon 1 -->
                            <div class="p-3 border rounded-lg flex justify-between items-center transition duration-150" style="border-color: #2e7d32;">
                                <div>
                                    <p class="font-bold text-green-700">BEST4YOU</p>
                                    <p class="text-xs text-gray-500">Coupon applied successfully!</p>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold text-green-700">-₹22,745</p>
                                    <button class="text-xs text-red-500 hover:underline" onclick="removeCoupon('BEST4YOU')">REMOVE</button>
                                </div>
                            </div>

                            <!-- Coupon 2 (Inactive) -->
                            <div class="p-3 border rounded-lg flex justify-between items-center bg-gray-50/50 border-gray-200">
                                <div>
                                    <p class="font-bold text-gray-500">MMTHOLD</p>
                                    <p class="text-xs text-gray-500">Grab 10% Discount before its Gone!</p>
                                </div>
                                <div class="text-right">
                                    <p class="font-bold text-green-700">₹2,174</p>
                                    <button class="text-xs text-blue-600 hover:underline" onclick="applyCoupon('MMTHOLD')">APPLY</button>
                                </div>
                            </div>
                        </div>

                        <button class="text-blue-600 text-xs font-medium mt-4 hover:underline">+14 More</button>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- START: Customization Modal Dialog (Existing) -->
    <div id="customization-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-md p-6 transform transition-all duration-300">
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h3 class="text-xl font-bold text-gray-900">Customize Your Trip</h3>
                <button class="text-gray-400 hover:text-gray-700" onclick="closeCustomizationModal()">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <div class="space-y-4">
                <!-- Travel Date Customization -->
                <div class="form-input-group">
                    <label for="new-start-date" class="form-label text-base">New Travel Start Date</label>
                    <input type="date" id="new-start-date" class="form-input" value="2025-10-13">
                </div>

                <!-- Client Location Customization -->
                <div class="form-input-group">
                    <label for="new-from-location" class="form-label text-base">New Origin Location (From)</label>
                    <input type="text" id="new-from-location" class="form-input" placeholder="e.g., Kolkata, Delhi, Mumbai" value="Bhubaneswar">
                    <p class="text-xs text-gray-500 mt-1">Current: From Bhubaneswar</p>
                </div>
            </div>

            <div class="mt-6 flex justify-end space-x-3">
                <button class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-100 transition" onclick="closeCustomizationModal()">Cancel</button>
                <button class="px-4 py-2 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition" onclick="applyCustomizationChanges()">Apply Changes</button>
            </div>
        </div>
    </div>
    <!-- END: Customization Modal Dialog -->

    <!-- START: Add Traveler Modal Dialog (NEW) -->
    <div id="add-traveler-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg p-6 transform transition-all duration-300">
            <div class="flex justify-between items-center border-b pb-3 mb-4">
                <h3 class="text-xl font-bold text-gray-900">Add Traveller Details</h3>
                <button class="text-gray-400 hover:text-gray-700" onclick="closeAddTravelerModal()">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>
            
            <!-- Current Traveler Status -->
            <div id="modal-traveler-status" class="text-xl font-semibold mb-4">Traveller 1/4</div>

            <!-- Traveler Pills/Tabs -->
            <div id="traveler-pills" class="flex space-x-2 mb-6">
                <!-- Pills will be generated by JS -->
            </div>

            <!-- Mandatory Information Form -->
            <div class="space-y-4">
                <h4 class="font-bold text-gray-900">Mandatory Information</h4>
                <p class="text-sm text-gray-700">Please Enter Mandatory Information</p>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="form-input-group">
                        <label for="traveler-first-name" class="form-label">First Name*</label>
                        <input type="text" id="traveler-first-name" class="form-input" placeholder="Enter a First Name">
                    </div>
                    <div class="form-input-group">
                        <label for="traveler-last-name" class="form-label">Last Name*</label>
                        <input type="text" id="traveler-last-name" class="form-input" placeholder="Enter a Last Name">
                    </div>
                    <div class="form-input-group">
                        <label for="traveler-dob-dd" class="form-label">Date Of Birth*</label>
                        <div class="flex space-x-1">
                            <select id="traveler-dob-dd" class="form-select w-1/3">
                                <option value="">DD</option>
                            </select>
                            <select id="traveler-dob-mm" class="form-select w-1/3">
                                <option value="">MM</option>
                            </select>
                            <select id="traveler-dob-yyyy" class="form-select w-1/3">
                                <option value="">YYYY</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="form-input-group">
                        <label for="traveler-gender" class="form-label">Gender*</label>
                        <select id="traveler-gender" class="form-select">
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="mt-8">
                <button class="w-full bg-blue-600 text-white font-semibold py-3 rounded-lg hover:bg-blue-700 transition" onclick="confirmTravelerDetails()">CONFIRM DETAILS</button>
            </div>
        </div>
    </div>
    <!-- END: Add Traveler Modal Dialog -->

    <script type="module">
        // Initialize Lucide Icons
        lucide.createIcons();
        
        // ------------------------------------
        // SECTION SWITCHING LOGIC (NEW)
        // ------------------------------------
        window.showSection = function(stepNumber) {
            // 1. Hide all content sections
            document.querySelectorAll('.booking-section').forEach(section => {
                section.classList.add('hidden');
            });

            // 2. Show the requested section
            const targetSection = document.getElementById(`section-${stepNumber}`);
            if (targetSection) {
                targetSection.classList.remove('hidden');
            }

            // 3. Update the header steps (visual tabs)
            document.querySelectorAll('.header-step').forEach(step => {
                const currentStep = parseInt(step.getAttribute('data-step'));
                if (currentStep === stepNumber) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });

             // Scroll to the top of the main content area for a smooth transition
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
        
        // ------------------------------------
        // Pricing Constants (Per Person)
        // ------------------------------------
        const GROSS_COST_PER_PERSON = 18999; // Base Fare per person
        const DISCOUNT_PER_PERSON = 7500;    // Coupon discount per person (derived from 22745/3)
        const INSURANCE_PER_PERSON = 700;    // Insurance per person
        const TAX_PER_PERSON = 300;          // Service Tax/Item Tax per person
        const GST_PERCENTAGE = 0.05;         // 5% GST rate

        // Global state to track which traveler is currently being edited
        let currentTravelerId = null;
        // Start with the 4 travelers already in the DOM
        let travelerIds = ['traveler-1', 'traveler-2', 'traveler-3', 'traveler-4']; 
        let currentTravelerCount = travelerIds.length;
        
        // Data structure to hold traveler data
        const travelerData = {};

        // ------------------------------------
        // Price Calculation and DOM Update
        // ------------------------------------
        window.updatePriceSummary = function() {
            const travelerCount = travelerIds.length;
            
            // --- Calculations ---
            
            // 1. Basic Cost (Total)
            const totalBasicCost = travelerCount * GROSS_COST_PER_PERSON;

            // 2. Fixed Costs (Total)
            const totalInsurance = travelerCount * INSURANCE_PER_PERSON;
            const totalItemAndTaxes = travelerCount * TAX_PER_PERSON;
            
            // 3. GST Calculation (5% of Subtotal before discount)
            const subtotalBeforeGST = totalBasicCost + totalInsurance + totalItemAndTaxes;
            // Rounded to the nearest whole number for display
            const totalGST = Math.round(subtotalBeforeGST * GST_PERCENTAGE); 

            // 4. Subtotal Gross
            const subtotalGross = subtotalBeforeGST + totalGST;

            // 5. Discount (Dynamic)
            const totalCouponDiscount = travelerCount * DISCOUNT_PER_PERSON;
            
            // 6. Grand Total
            const grandTotal = subtotalGross - totalCouponDiscount;

            // --- Update DOM Elements (Formatted with Indian localization) ---
            
            // Total in Sidebar
            document.getElementById('grand-total-amount').textContent = `₹${grandTotal.toLocaleString('en-IN')}`;
            
            // Fare Breakdown
            
            // 1. Total Basic Cost
            document.getElementById('fare-breakup-basic-cost').innerHTML = 
                `Total Basic Cost <span class="text-xs text-gray-500 block">(${GROSS_COST_PER_PERSON.toLocaleString('en-IN')} x ${travelerCount} Travellers)</span>`;
            document.getElementById('fare-breakup-basic-cost-value').textContent = `₹${totalBasicCost.toLocaleString('en-IN')}`;

            // 2. Coupon Discount
            document.getElementById('fare-breakup-coupon-value').textContent = `-₹${totalCouponDiscount.toLocaleString('en-IN')}`;

            // 3. Insurance
            document.getElementById('fare-breakup-insurance-value').textContent = `₹${totalInsurance.toLocaleString('en-IN')}`;

            // 4. Item & Taxes Total (Sum of Service Tax + GST)
            const totalTaxesFees = totalItemAndTaxes + totalGST;
            document.getElementById('fare-breakup-tax-value-total').textContent = `₹${totalTaxesFees.toLocaleString('en-IN')}`;

            // 5. Detailed Tax Breakdown (Service Tax)
            document.getElementById('fare-breakup-tax-value').textContent = `₹${totalItemAndTaxes.toLocaleString('en-IN')}`;
            
            // 6. Detailed Tax Breakdown (GST)
            document.getElementById('fare-breakup-gst-value').textContent = `₹${totalGST.toLocaleString('en-IN')}`;
        }


        // Function to update the summary count in the header/sidebar
        function updateSummaryCount() {
            const roomDetailsEl = document.getElementById('room-details');
            const grandTotalAdultsEl = document.getElementById('grand-total-adults');

            // Recalculate count based on the current travelerIds array size
            currentTravelerCount = travelerIds.length;
            const adultLabel = currentTravelerCount > 1 ? 'Adults' : 'Adult';


            if (roomDetailsEl) {
                roomDetailsEl.textContent = `1 Room - ${currentTravelerCount} ${adultLabel}`;
            }
            if (grandTotalAdultsEl) {
                grandTotalAdultsEl.textContent = `Grand Total - ${currentTravelerCount} ${adultLabel}`;
            }
            
            // Disable remove button if only one traveler remains
            travelerIds.forEach(id => {
                const travelerNum = id.split('-')[1];
                const removeBtn = document.getElementById(`t${travelerNum}-remove-btn`);
                if (removeBtn) {
                    removeBtn.disabled = currentTravelerCount <= 1;
                    removeBtn.classList.toggle('opacity-50', currentTravelerCount <= 1);
                    removeBtn.classList.toggle('hover:underline', currentTravelerCount > 1);
                }
            });

            // IMPORTANT: Call price update after traveler count is updated
            updatePriceSummary();
        }

        // ------------------------------------
        // Utility function to format date
        // ------------------------------------
        function formatDateCustom(date) {
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];

            const dayName = days[date.getDay()];
            const monthName = months[date.getMonth()];
            const dayNum = date.getDate();
            const year = date.getFullYear();

            return `${dayName}, ${monthName} ${dayNum}, ${year}`;
        }
        
        // ------------------------------------
        // DOB Dropdown Population Helpers
        // ------------------------------------
        function populateDobDropdowns() {
            const ddSelect = document.getElementById('traveler-dob-dd');
            const mmSelect = document.getElementById('traveler-dob-mm');
            const yyyySelect = document.getElementById('traveler-dob-yyyy');

            // Days (1-31)
            for (let i = 1; i <= 31; i++) {
                const option = document.createElement('option');
                option.value = String(i).padStart(2, '0');
                option.textContent = String(i).padStart(2, '0');
                ddSelect.appendChild(option);
            }

            // Months (1-12)
            const monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
            monthNames.forEach((name, index) => {
                const option = document.createElement('option');
                option.value = String(index + 1).padStart(2, '0');
                option.textContent = name;
                mmSelect.appendChild(option);
            });

            // Years (Last 100 years from current year)
            const currentYear = new Date().getFullYear();
            for (let i = currentYear; i >= currentYear - 100; i--) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                yyyySelect.appendChild(option);
            }
        }
        
        // ------------------------------------
        // Traveler Management Logic 
        // ------------------------------------
        
        // Function to create the HTML for a new traveler card
        function createNewTravelerCard(travelerId, travelerNum, ageText) {
             const card = document.createElement('div');
             card.id = travelerId;
             card.className = 'traveler-card';
             card.innerHTML = `
                 <div class="flex items-center justify-between mb-2">
                     <span class="flex items-center">
                         <i data-lucide="user-circle" class="w-6 h-6 mr-3 text-blue-600"></i>
                         <span class="font-medium text-lg" id="t${travelerNum}-name-title">Traveler ${travelerNum}</span>
                         <!-- NEW: Profile Status Badge -->
                         <span id="t${travelerNum}-profile-status" class="flex items-center text-sm text-green-600 ml-3 hidden">
                             <i data-lucide="check-circle" class="w-4 h-4 mr-1"></i> Profile Updated
                         </span>
                     </span>
                     <div class="flex space-x-3 items-center">
                          <button id="t${travelerNum}-btn" class="text-blue-600 font-medium text-sm hover:underline" onclick="openAddTravelerModal('${travelerId}')">Add Traveler</button>
                          <button id="t${travelerNum}-remove-btn" class="text-red-500 font-medium text-sm hover:underline" onclick="removeTraveler('${travelerId}')">Remove</button>
                     </div>
                 </div>
                 <!-- Updated: Name now displayed here, using 'tX-name-detail' -->
                 <div id="t${travelerNum}-name-detail" class="text-base font-bold text-blue-900 ml-9 hidden"></div>
                 <p class="text-xs text-gray-500 mt-2">${ageText}</p>
                `;
             return card;
        }

        // Function to handle dynamic traveler addition
        window.addDynamicTraveler = function() {
            const nextTravelerNum = travelerIds.length + 1;
            const newTravelerId = `traveler-${nextTravelerNum}`;
            
            travelerIds.push(newTravelerId);

            // Determine age text based on position (T3 is child in the original design)
            const isChild = (nextTravelerNum === 3); 
            const ageText = isChild ? "ADULT - SHOULD BE ABOVE 12 YEARS" : "ADULT - SHOULD BE ABOVE 18 YEARS";
            
            const newCard = createNewTravelerCard(newTravelerId, nextTravelerNum, ageText);

            // This appends the new traveler card sequentially after the last existing one.
            document.getElementById('travelers-container').appendChild(newCard); 
            
            // Re-render lucide icons for the new card
            lucide.createIcons();
            
            // Update the summary in the header/sidebar
            updateSummaryCount();

            // Open the modal immediately for the new traveler
            openAddTravelerModal(newTravelerId);
        }
        
        // Function to remove a traveler
        window.removeTraveler = function(idToRemove) {
            if (travelerIds.length <= 1) {
                showConfirmationMessage('Cannot Remove Last Traveler', 'A booking must contain at least one traveler.', 'red');
                return;
            }

            // Find the index and remove from the global array
            const indexToRemove = travelerIds.indexOf(idToRemove);
            if (indexToRemove === -1) return; // Traveler ID not found

            // 1. Remove from DOM
            const cardEl = document.getElementById(idToRemove);
            if (cardEl) {
                cardEl.remove();
            }

            // 2. Remove from state
            travelerIds.splice(indexToRemove, 1);
            delete travelerData[idToRemove];

            // 3. Re-index the remaining cards/buttons/statuses (Crucial for visual consistency)
            travelerIds.forEach((oldId, index) => {
                const newNum = index + 1;
                const oldNum = parseInt(oldId.split('-')[1]);
                const newId = `traveler-${newNum}`;
                
                // Only rename if the ID doesn't match the expected new numerical index
                if (oldId !== newId) {
                    const el = document.getElementById(oldId);
                    if (el) {
                        el.id = newId; // Update main card ID
                        
                        // Update dynamic name/status elements
                        const nameTitle = el.querySelector(`#t${oldNum}-name-title`);
                        if(nameTitle) nameTitle.textContent = `Traveler ${newNum}`;

                        const profileStatus = document.getElementById(`t${oldNum}-profile-status`);
                        if(profileStatus) profileStatus.id = `t${newNum}-profile-status`;

                        // Update buttons/status IDs
                        const btn = document.getElementById(`t${oldNum}-btn`);
                        if(btn) {
                            btn.id = `t${newNum}-btn`;
                            btn.setAttribute('onclick', `openAddTravelerModal('${newId}')`);
                        }
                        const removeBtn = document.getElementById(`t${oldNum}-remove-btn`);
                        if(removeBtn) {
                            removeBtn.id = `t${newNum}-remove-btn`;
                            removeBtn.setAttribute('onclick', `removeTraveler('${newId}')`);
                        }
                        // Update the name detail div ID
                        const nameDetail = document.getElementById(`t${oldNum}-name-detail`);
                        if(nameDetail) nameDetail.id = `t${newNum}-name-detail`;
                        
                        // Update the age text for Traveler 3 (if it was the child slot)
                        const ageTextEl = el.querySelector('.text-xs.text-gray-500');
                        // Use default adult text unless it lands on the T3 slot
                        let newAgeText = 'ADULT - SHOULD BE ABOVE 18 YEARS';
                        if (newNum === 3) {
                             newAgeText = 'ADULT - SHOULD BE ABOVE 12 YEARS';
                        }
                        if (ageTextEl) {
                           ageTextEl.textContent = newAgeText;
                        }
                        
                        // Update ID in the global lookup array
                        travelerIds[index] = newId;
                        
                        // Update data key in travelerData if it exists
                        if (travelerData[oldId]) {
                            travelerData[newId] = travelerData[oldId];
                            delete travelerData[oldId];
                        }
                    }
                }
            });


            // 4. Update Summary
            updateSummaryCount();
            
            showConfirmationMessage('Traveler Removed', `Traveler ${indexToRemove + 1} has been successfully removed.`, 'green');
        }


        function generateTravelerPills(activeId) {
            const pillsContainer = document.getElementById('traveler-pills');
            pillsContainer.innerHTML = '';
            
            travelerIds.forEach(id => {
                const i = parseInt(id.split('-')[1]);
                const travelerDiv = document.createElement('div');
                travelerDiv.id = `pill-${id}`;
                travelerDiv.className = 'traveler-pill flex-1';
                if (id === activeId) {
                    travelerDiv.classList.add('active-pill');
                }
                travelerDiv.onclick = () => openAddTravelerModal(id);
                
                // Traveler 3 is the 'child' traveler in the fixed initial list
                const isChild = (i === 3 && travelerIds.length >= 3); 
                const icon = 'user';
                const label = isChild ? `ADULT-${i} (Child)` : `ADULT-${i}`;

                const status = travelerData[id]?.status === 'confirmed' ? 'text-green-600' : 'text-blue-600';
                
                travelerDiv.innerHTML = `
                    <i data-lucide="${icon}" class="pill-icon ${status}"></i>
                    <span class="text-xs">${label}</span>
                `;
                pillsContainer.appendChild(travelerDiv);
            });
            // Re-render lucide icons after injecting HTML
            lucide.createIcons();
        }

        function loadTravelerData(id) {
            const data = travelerData[id] || {};
            document.getElementById('traveler-first-name').value = data.firstName || '';
            document.getElementById('traveler-last-name').value = data.lastName || '';
            document.getElementById('traveler-dob-dd').value = data.dobDd || '';
            document.getElementById('traveler-dob-mm').value = data.dobMm || '';
            document.getElementById('traveler-dob-yyyy').value = data.dobYyyy || '';
            document.getElementById('traveler-gender').value = data.gender || '';
        }

        function saveTravelerData(id) {
            travelerData[id] = {
                firstName: document.getElementById('traveler-first-name').value,
                lastName: document.getElementById('traveler-last-name').value,
                dobDd: document.getElementById('traveler-dob-dd').value,
                dobMm: document.getElementById('traveler-dob-mm').value,
                dobYyyy: document.getElementById('traveler-dob-yyyy').value,
                gender: document.getElementById('traveler-gender').value,
                status: 'confirmed'
            };
        }

        window.updateTravelerCard = function(id) {
            const data = travelerData[id];
            const travelerNum = id.split('-')[1];
            
            // Target the div below the header for name display
            const nameDetailEl = document.getElementById(`t${travelerNum}-name-detail`); 
            const profileStatusEl = document.getElementById(`t${travelerNum}-profile-status`); // 'Profile Updated' badge
            const cardButton = document.getElementById(`t${travelerNum}-btn`);
            
            if (data && data.status === 'confirmed') {
                const fullName = `${data.firstName} ${data.lastName}`;
                
                // 1. Update traveler name and show it with requested styling (deep water color and bold)
                nameDetailEl.textContent = fullName;
                nameDetailEl.classList.remove('hidden');
                // Apply requested deep water color (blue-900) and bold/size styling
                nameDetailEl.classList.add('font-bold', 'text-blue-900', 'text-base', 'pt-1'); 

                // 2. Show green "Profile Updated" status badge
                profileStatusEl.classList.remove('hidden');
                
                // 3. Update button to "Edit Details"
                cardButton.textContent = 'Edit Details';
            } else {
                 // Resetting to initial state
                 nameDetailEl.classList.add('hidden');
                 nameDetailEl.classList.remove('font-bold', 'text-blue-900', 'text-base', 'pt-1');
                 profileStatusEl.classList.add('hidden');
                 cardButton.textContent = 'Add Traveler';
            }
            // Re-render icons after state change
            lucide.createIcons();
        }


        window.openAddTravelerModal = function(id) {
            currentTravelerId = id;
            const travelerNum = id.split('-')[1];
            
            // 1. Update status text
            document.getElementById('modal-traveler-status').textContent = `Traveller ${travelerNum}/${travelerIds.length}`;

            // 2. Generate and highlight pills
            generateTravelerPills(id);
            
            // 3. Load existing data
            loadTravelerData(id);

            // 4. Show modal
            document.getElementById('add-traveler-modal').classList.remove('hidden');
        }

        window.closeAddTravelerModal = function() {
            document.getElementById('add-traveler-modal').classList.add('hidden');
            currentTravelerId = null;
        }

        window.confirmTravelerDetails = function() {
            const firstName = document.getElementById('traveler-first-name').value;
            const lastName = document.getElementById('traveler-last-name').value;
            const dobDd = document.getElementById('traveler-dob-dd').value;
            const dobMm = document.getElementById('traveler-dob-mm').value;
            const dobYyyy = document.getElementById('traveler-dob-yyyy').value;
            const gender = document.getElementById('traveler-gender').value;

            // Basic validation
            if (!firstName || !lastName || !dobDd || !dobMm || !dobYyyy || !gender) {
                // Using a non-alert message box for error
                showConfirmationMessage('Error', 'Please fill in all mandatory fields.', 'red');
                return;
            }

            // 1. Save data to state
            saveTravelerData(currentTravelerId);

            // 2. Update the main card display
            updateTravelerCard(currentTravelerId);

            // 3. Show success message (or simply close)
            showConfirmationMessage('Success!', 'Traveler details confirmed and added to the trip.', 'green');

            // 4. Automatically jump to the next unconfirmed traveler or close
            const currentNum = parseInt(currentTravelerId.split('-')[1]);
            let nextId = null;

            for (let i = travelerIds.indexOf(currentTravelerId) + 1; i < travelerIds.length; i++) {
                const nextTravId = travelerIds[i];
                if (travelerData[nextTravId]?.status !== 'confirmed') {
                    nextId = nextTravId;
                    break;
                }
            }

            if (nextId) {
                openAddTravelerModal(nextId);
            } else {
                 closeAddTravelerModal(); // If all travelers are confirmed, close the modal.
            }
        }

        // Custom Message Box function (replaces alert)
        function showConfirmationMessage(title, message, color) {
             const bgColor = color === 'green' ? 'bg-green-600' : 'bg-red-600';
             const modal = document.createElement('div');
             modal.className = "fixed inset-0 bg-gray-900 bg-opacity-75 z-[60] flex items-center justify-center p-4";
             
             // Define the content and button action using the modal reference
             modal.innerHTML = `
                 <div class="bg-white rounded-lg shadow-2xl w-full max-w-xs p-5">
                     <h4 class="font-bold text-lg mb-3 ${color === 'green' ? 'text-green-600' : 'text-red-600'}">${title}</h4>
                     <p class="text-sm whitespace-pre-line text-gray-700">${message}</p>
                     <button id="close-msg-btn" class="mt-4 w-full ${bgColor} text-white py-2 rounded-lg">Close</button>
                 </div>
             `;
             document.body.appendChild(modal);

             // Attach the event listener after the modal is in the DOM
             document.getElementById('close-msg-btn').addEventListener('click', () => {
                 // Remove the parent modal element
                 modal.remove(); 
             });
        }

        // ------------------------------------
        // Customization Modal Functions (Existing)
        // ------------------------------------
        window.openCustomizationModal = function() {
            document.getElementById('customization-modal').classList.remove('hidden');
        }

        window.closeCustomizationModal = function() {
            document.getElementById('customization-modal').classList.add('hidden');
        }

        window.applyCustomizationChanges = function() {
            const newStartDateStr = document.getElementById('new-start-date').value;
            const newLocation = document.getElementById('new-from-location').value;

            const packageDatesEl = document.getElementById('package-dates');
            const packageLocationEl = document.getElementById('package-location');
            
            // --- 1. Update Date ---
            if (newStartDateStr && packageDatesEl) {
                const [year, month, day] = newStartDateStr.split('-').map(Number);
                const actualStartDate = new Date(year, month - 1, day); 

                const endDate = new Date(actualStartDate);
                endDate.setDate(actualStartDate.getDate() + 3); 

                const formattedStartDate = formatDateCustom(actualStartDate);
                const formattedEndDate = formatDateCustom(endDate);
                
                packageDatesEl.textContent = `${formattedStartDate} - ${formattedEndDate}`;
            }

            // --- 2. Update Location ---
            if (newLocation && packageLocationEl) {
                packageLocationEl.textContent = `/ From ${newLocation}`;
                const locationInput = document.getElementById('new-from-location');
                if(locationInput.nextElementSibling) {
                    locationInput.nextElementSibling.textContent = `Current: From ${newLocation}`;
                }
            }
            
            closeCustomizationModal();
        }

        // ------------------------------------
        // 2. Mobile Code Data and Population
        // ------------------------------------
        const countryCodes = [
            { country: 'India', code: '+91', selected: true },
            { country: 'United States', code: '+1' },
            { country: 'United Kingdom', code: '+44' },
            { country: 'Canada', code: '+1' },
            { country: 'Australia', code: '+61' },
            { country: 'Germany', code: '+49' },
            { country: 'France', code: '+33' },
            { country: 'Japan', code: '+81' },
            { country: 'Brazil', code: '+55' },
            { country: 'Mexico', code: '+52' },
            { country: 'China', code: '+86' },
            { country: 'Russia', code: '+7' },
            { country: 'South Korea', code: '+82' },
            { country: 'UAE', code: '+971' },
        ];

        function populateCountryCodes() {
            const selectElement = document.getElementById('country-code');
            if (!selectElement) return;

            countryCodes.forEach(item => {
                const option = document.createElement('option');
                option.value = item.code;
                option.textContent = `${item.country} (${item.code})`;
                if (item.selected) {
                    option.selected = true;
                }
                selectElement.appendChild(option);
            });
        }

        // ------------------------------------
        // 3. GST State Data and Population
        // ------------------------------------
        const indianStatesUTs = [
            'Select State',
            'Andhra Pradesh', 'Arunachal Pradesh', 'Assam', 'Bihar', 'Chhattisgarh', 'Goa', 'Gujarat', 
            'Haryana', 'Himachal Pradesh', 'Jharkhand', 'Karnataka', 'Kerala', 'Madhya Pradesh', 'Maharashtra', 
            'Manipur', 'Meghalaya', 'Mizoram', 'Nagaland', 'Odisha', 'Punjab', 'Rajasthan', 'Sikkim', 
            'Tamil Nadu', 'Telangana', 'Tripura', 'Uttar Pradesh', 'Uttarakhand', 'West Bengal',
            'Andaman and Nicobar Islands (UT)', 'Chandigarh (UT)', 'Dadra and Nagar Haveli and Daman and Diu (UT)',
            'Delhi (NCT)', 'Jammu and Kashmir (UT)', 'Ladakh (UT)', 'Lakshadweep (UT)', 'Puducherry (UT)',
        ];

        function populateGstStates() {
            const selectElement = document.getElementById('gst-state');
            if (!selectElement) return;

            selectElement.innerHTML = ''; 

            indianStatesUTs.forEach(state => {
                const option = document.createElement('option');
                option.value = state;
                option.textContent = state;
                if (state === 'Maharashtra') { 
                    option.selected = true;
                }
                if (state === 'Select State') {
                    option.disabled = true; 
                }
                selectElement.appendChild(option);
            });
        }

        // Run initial setup functions on script load
        populateCountryCodes();
        populateGstStates();
        populateDobDropdowns();
        updateSummaryCount(); // Initial summary update
        showSection(1); // Ensure Traveler Details is shown on load


        // ------------------------------------
        // 4. Terms & Conditions Check / Button Enable
        // ------------------------------------
        const acceptTermsCheckbox = document.getElementById('accept-terms');
        const proceedBtn = document.getElementById('proceed-btn');
        const proceedLink = document.getElementById('proceed-link');

        function updateProceedButtonState() {
            const isChecked = acceptTermsCheckbox.checked;
            proceedBtn.disabled = !isChecked;
            if (isChecked) {
                proceedLink.classList.remove('disabled');
            } else {
                proceedLink.classList.add('disabled');
            }
        }

        acceptTermsCheckbox.addEventListener('change', updateProceedButtonState);
        updateProceedButtonState(); // Initial check


        // ------------------------------------
        // 5. Simple Countdown Timer
        // ------------------------------------
        const timerEl = document.getElementById('timer');
        let totalSeconds = 7 * 60 + 26; 

        function updateTimer() {
            if (totalSeconds <= 0) {
                clearInterval(timerInterval);
                timerEl.textContent = 'Expired';
                timerEl.classList.add('bg-red-700');
                proceedBtn.disabled = true;
                return;
            }

            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;

            const minStr = String(minutes).padStart(1, '0');
            const secStr = String(seconds).padStart(2, '0');

            timerEl.textContent = `${minStr}:${secStr}`;
            totalSeconds--;
        }

        const timerInterval = setInterval(updateTimer, 1000);
        updateTimer();
        
        // ------------------------------------
        // 6. Coupon Placeholders
        // ------------------------------------
        window.removeCoupon = function(code) {
             console.log(`Coupon ${code} removed.`);
        }

        window.applyCoupon = function(code) {
             console.log(`Coupon ${code} applied.`);
        }

    </script>
</body>
</html>
